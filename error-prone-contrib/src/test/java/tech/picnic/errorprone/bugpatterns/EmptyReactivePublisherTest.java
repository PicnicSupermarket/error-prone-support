package tech.picnic.errorprone.bugpatterns;

import com.google.errorprone.CompilationTestHelper;
import org.junit.jupiter.api.Test;

final class EmptyReactivePublisherTest {
  @Test
  void identification() {
    CompilationTestHelper.newInstance(EmptyReactivePublisher.class, getClass())
        .addSourceLines(
            "A.java",
            "import com.google.common.collect.ImmutableSet;",
            "import reactor.core.publisher.Flux;",
            "import reactor.core.publisher.Mono;",
            "import reactor.util.context.Context;",
            "",
            "class A {",
            "  void m() {",
            "    Mono.just(1).doOnNext(i -> {});",
            "    Mono.just(2).filter(i -> true);",
            "    Mono.just(3).flatMap(Mono::just);",
            "    Mono.just(4).flatMapMany(Flux::just);",
            "    Mono.just(5).flatMapIterable(ImmutableSet::of);",
            "    Mono.just(6).handle((i, j) -> {});",
            "    Mono.just(7).map(i -> i);",
            "",
            "    // BUG: Diagnostic contains: Operator `doOnNext` on an empty `Mono` is a no-op",
            "    Mono.empty().doOnNext(i -> {});",
            "    // BUG: Diagnostic contains: Operator `filter` on an empty `Mono` is a no-op",
            "    Mono.empty().filter(i -> true);",
            "    // BUG: Diagnostic contains: Operator `flatMap` on an empty `Mono` is a no-op",
            "    Mono.empty().flatMap(Mono::just);",
            "    // BUG: Diagnostic contains: Operator `flatMapMany` on an empty `Mono` is a no-op",
            "    Mono.empty().flatMapMany(Flux::just);",
            "    // BUG: Diagnostic contains: Operator `flatMapIterable` on an empty `Mono` is a no-op",
            "    Mono.empty().flatMapIterable(ImmutableSet::of);",
            "    // BUG: Diagnostic contains: Operator `handle` on an empty `Mono` is a no-op",
            "    Mono.empty().handle((i, j) -> {});",
            "    // BUG: Diagnostic contains: Operator `map` on an empty `Mono` is a no-op",
            "    Mono.empty().map(i -> i);",
            "",
            "    // BUG: Diagnostic contains: Operator `doOnNext` on an empty `Flux` is a no-op",
            "    Flux.empty().doOnNext(i -> {});",
            "    // BUG: Diagnostic contains: Operator `filter` on an empty `Flux` is a no-op",
            "    Flux.empty().filter(i -> true);",
            "    // BUG: Diagnostic contains: Operator `concatMap` on an empty `Flux` is a no-op",
            "    Flux.empty().concatMap(Mono::just);",
            "    // BUG: Diagnostic contains: Operator `flatMap` on an empty `Flux` is a no-op",
            "    Flux.empty().flatMap(Mono::just);",
            "    // BUG: Diagnostic contains: Operator `flatMapSequential` on an empty `Flux` is a no-op",
            "    Flux.empty().flatMapSequential(Flux::just);",
            "    // BUG: Diagnostic contains: Operator `flatMapIterable` on an empty `Flux` is a no-op",
            "    Flux.empty().flatMapIterable(ImmutableSet::of);",
            "    // BUG: Diagnostic contains: Operator `handle` on an empty `Flux` is a no-op",
            "    Flux.empty().handle((i, j) -> {});",
            "    // BUG: Diagnostic contains: Operator `map` on an empty `Flux` is a no-op",
            "    Flux.empty().map(i -> i);",
            "",
            "    // BUG: Diagnostic contains: Operator `doOnNext` on an empty `Mono` is a no-op",
            "    Mono.just(8).then().doOnNext(i -> {});",
            "    // BUG: Diagnostic contains: Operator `filter` on an empty `Mono` is a no-op",
            "    Mono.just(9).then().filter(i -> true);",
            "    // BUG: Diagnostic contains: Operator `flatMap` on an empty `Mono` is a no-op",
            "    Mono.just(10).then().flatMap(Mono::just);",
            "    // BUG: Diagnostic contains: Operator `flatMapMany` on an empty `Mono` is a no-op",
            "    Mono.just(11).then().flatMapMany(Flux::just);",
            "    // BUG: Diagnostic contains: Operator `flatMapIterable` on an empty `Mono` is a no-op",
            "    Mono.just(12).then().flatMapIterable(ImmutableSet::of);",
            "    // BUG: Diagnostic contains: Operator `handle` on an empty `Mono` is a no-op",
            "    Mono.just(13).then().handle((i, j) -> {});",
            "    // BUG: Diagnostic contains: Operator `map` on an empty `Mono` is a no-op",
            "    Mono.just(14).then().map(i -> i);",
            "",
            "    Mono.just(15).subscribe();",
            "    Mono.just(16).subscribe(null, t -> {});",
            "",
            "    // BUG: Diagnostic contains: Passing an on next signal `Consumer` on empty `Publisher` is a no-op",
            "    Mono.just(17).then().subscribe(i -> {});",
            "    // BUG: Diagnostic contains: Passing an on next signal `Consumer` on empty `Publisher` is a no-op",
            "    Mono.just(18).then().subscribe(i -> {}, t -> {});",
            "    // BUG: Diagnostic contains: Passing an on next signal `Consumer` on empty `Publisher` is a no-op",
            "    Mono.just(19).then().subscribe(i -> {}, t -> {}, () -> {});",
            "    // BUG: Diagnostic contains: Passing an on next signal `Consumer` on empty `Publisher` is a no-op",
            "    Mono.just(20).then().subscribe(i -> {}, t -> {}, () -> {}, j -> {});",
            "    // BUG: Diagnostic contains: Passing an on next signal `Consumer` on empty `Publisher` is a no-op",
            "    Mono.just(21).then().subscribe(i -> {}, t -> {}, () -> {}, Context.empty());",
            "  }",
            "}")
        .doTest();
  }
}
